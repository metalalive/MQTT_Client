#include "mqtt_include.h"

#define NUM_TEST_CERTS 2

// clang-format off
static const byte mock_DER_encoded_crt_data[NUM_TEST_CERTS][1700] = {
{ // cert algorithm ID = sha384WithRSAEncryption
  0x30, 0x82, 0x04, 0xeb, 0x30, 0x82, 0x02, 0xd3, 0xa0, 0x03, 0x02, 0x01,
  0x02, 0x02, 0x14, 0x2c, 0xac, 0x27, 0x37, 0x24, 0xd9, 0x9a, 0x2c, 0x16,
  0x48, 0x74, 0xe0, 0x78, 0xc0, 0x24, 0x7f, 0xd2, 0x09, 0x79, 0x1c, 0x30,
  0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0c,
  0x05, 0x00, 0x30, 0x81, 0x9c, 0x31, 0x0b, 0x30, 0x09, 0x06, 0x03, 0x55,
  0x04, 0x06, 0x13, 0x02, 0x44, 0x45, 0x31, 0x0f, 0x30, 0x0d, 0x06, 0x03,
  0x55, 0x04, 0x08, 0x0c, 0x06, 0x42, 0x65, 0x72, 0x6c, 0x69, 0x6e, 0x31,
  0x0f, 0x30, 0x0d, 0x06, 0x03, 0x55, 0x04, 0x07, 0x0c, 0x06, 0x42, 0x65,
  0x72, 0x6c, 0x69, 0x6e, 0x31, 0x11, 0x30, 0x0f, 0x06, 0x03, 0x55, 0x04,
  0x0a, 0x0c, 0x08, 0x54, 0x65, 0x73, 0x74, 0x20, 0x49, 0x6e, 0x63, 0x31,
  0x19, 0x30, 0x17, 0x06, 0x03, 0x55, 0x04, 0x0b, 0x0c, 0x10, 0x45, 0x6e,
  0x67, 0x69, 0x6e, 0x65, 0x65, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x54, 0x65,
  0x61, 0x6d, 0x31, 0x15, 0x30, 0x13, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c,
  0x0c, 0x31, 0x30, 0x31, 0x2e, 0x33, 0x2e, 0x32, 0x35, 0x33, 0x2e, 0x39,
  0x35, 0x31, 0x26, 0x30, 0x24, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7,
  0x0d, 0x01, 0x09, 0x01, 0x16, 0x17, 0x65, 0x6e, 0x67, 0x69, 0x6e, 0x65,
  0x65, 0x72, 0x69, 0x6e, 0x67, 0x40, 0x74, 0x65, 0x73, 0x74, 0x69, 0x6e,
  0x63, 0x2e, 0x6f, 0x72, 0x67, 0x30, 0x1e, 0x17, 0x0d, 0x32, 0x30, 0x30,
  0x32, 0x31, 0x37, 0x30, 0x37, 0x32, 0x38, 0x32, 0x31, 0x5a, 0x17, 0x0d,
  0x32, 0x39, 0x31, 0x31, 0x31, 0x36, 0x30, 0x37, 0x32, 0x38, 0x32, 0x31,
  0x5a, 0x30, 0x81, 0xa5, 0x31, 0x0b, 0x30, 0x09, 0x06, 0x03, 0x55, 0x04,
  0x06, 0x13, 0x02, 0x54, 0x57, 0x31, 0x0f, 0x30, 0x0d, 0x06, 0x03, 0x55,
  0x04, 0x08, 0x0c, 0x06, 0x54, 0x61, 0x69, 0x77, 0x61, 0x6e, 0x31, 0x0f,
  0x30, 0x0d, 0x06, 0x03, 0x55, 0x04, 0x07, 0x0c, 0x06, 0x54, 0x61, 0x69,
  0x70, 0x65, 0x69, 0x31, 0x1c, 0x30, 0x1a, 0x06, 0x03, 0x55, 0x04, 0x0a,
  0x0c, 0x13, 0x53, 0x6f, 0x6d, 0x65, 0x20, 0x72, 0x61, 0x6e, 0x64, 0x6f,
  0x6d, 0x20, 0x63, 0x6f, 0x6d, 0x70, 0x61, 0x6e, 0x79, 0x31, 0x19, 0x30,
  0x17, 0x06, 0x03, 0x55, 0x04, 0x0b, 0x0c, 0x10, 0x64, 0x65, 0x76, 0x65,
  0x6c, 0x6f, 0x70, 0x6d, 0x65, 0x6e, 0x74, 0x20, 0x74, 0x65, 0x61, 0x6d,
  0x31, 0x14, 0x30, 0x12, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x0b, 0x31,
  0x32, 0x33, 0x2e, 0x34, 0x35, 0x2e, 0x36, 0x2e, 0x37, 0x38, 0x31, 0x25,
  0x30, 0x23, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x09,
  0x01, 0x16, 0x16, 0x64, 0x65, 0x76, 0x74, 0x65, 0x61, 0x6d, 0x40, 0x72,
  0x61, 0x6e, 0x64, 0x63, 0x6f, 0x6d, 0x70, 0x61, 0x6e, 0x79, 0x2e, 0x69,
  0x6f, 0x30, 0x82, 0x01, 0x22, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48,
  0x86, 0xf7, 0x0d, 0x01, 0x01, 0x01, 0x05, 0x00, 0x03, 0x82, 0x01, 0x0f,
  0x00, 0x30, 0x82, 0x01, 0x0a, 0x02, 0x82, 0x01, 0x01, 0x00, 0xc2, 0x60,
  0xc0, 0x7e, 0x5f, 0xe6, 0xc6, 0x21, 0x45, 0xa9, 0x86, 0x62, 0x65, 0xcc,
  0x01, 0x1f, 0xd2, 0xb1, 0xe4, 0xef, 0x46, 0xac, 0xaa, 0x3c, 0xd0, 0x46,
  0x6a, 0xbb, 0x13, 0x84, 0xde, 0xb5, 0x29, 0x57, 0x6f, 0xf3, 0x21, 0x42,
  0xef, 0x42, 0x45, 0x9c, 0x60, 0x0a, 0xa6, 0x0f, 0x23, 0xe3, 0x9d, 0x56,
  0xa7, 0xa9, 0x78, 0x29, 0x3a, 0x8f, 0x1e, 0x1c, 0xf6, 0xda, 0x90, 0x59,
  0xd9, 0x21, 0x91, 0x86, 0x1c, 0x3d, 0x1f, 0x93, 0xbb, 0xdc, 0x9c, 0x98,
  0x89, 0x70, 0x7e, 0x11, 0xee, 0xf5, 0xdc, 0x29, 0x60, 0xaf, 0x66, 0xab,
  0x5d, 0x9c, 0x19, 0x04, 0x2b, 0x6b, 0x24, 0xe6, 0x9e, 0x01, 0x35, 0xd8,
  0x63, 0x1a, 0xe9, 0xd8, 0x9d, 0x57, 0x92, 0x66, 0xf0, 0xba, 0x1e, 0x14,
  0x7d, 0x12, 0x07, 0x9d, 0x95, 0xf5, 0x65, 0xad, 0x83, 0x44, 0x4e, 0xd9,
  0x78, 0x34, 0x7b, 0xac, 0x25, 0x67, 0xfc, 0x8c, 0xb1, 0x4f, 0x34, 0x9d,
  0xca, 0x61, 0xb8, 0xcf, 0xbd, 0xdd, 0x17, 0xdd, 0xbc, 0xc5, 0x0e, 0x74,
  0xe2, 0xe2, 0x78, 0x12, 0x92, 0x79, 0x55, 0x83, 0x9b, 0xf5, 0xf1, 0x3f,
  0x97, 0xb0, 0x55, 0x69, 0xe6, 0x6f, 0x3a, 0x8d, 0x63, 0xf5, 0x50, 0x7c,
  0xf2, 0xa6, 0x3a, 0x10, 0xc2, 0x35, 0xc1, 0x58, 0x3e, 0x33, 0x09, 0x0f,
  0xe1, 0x67, 0xb2, 0x1e, 0xa2, 0xa0, 0xc4, 0x27, 0xa4, 0x3d, 0x1a, 0xad,
  0xf8, 0x4f, 0xa4, 0x41, 0xfc, 0x8c, 0xae, 0x3b, 0xef, 0x87, 0x79, 0xc8,
  0x5a, 0x6d, 0x23, 0xd7, 0xb5, 0x7d, 0xd4, 0x88, 0x6c, 0xec, 0x45, 0xcf,
  0xca, 0x05, 0xda, 0xb3, 0x41, 0x38, 0xd0, 0x97, 0x45, 0xec, 0x2d, 0xa4,
  0x07, 0xf7, 0x16, 0x5c, 0x78, 0xcc, 0x5f, 0xd1, 0xb0, 0x4f, 0x02, 0xc0,
  0x01, 0x57, 0x1d, 0x36, 0x60, 0xfb, 0x0e, 0x17, 0x68, 0x82, 0x78, 0x11,
  0x9b, 0x9f, 0x02, 0x03, 0x01, 0x00, 0x01, 0xa3, 0x1a, 0x30, 0x18, 0x30,
  0x09, 0x06, 0x03, 0x55, 0x1d, 0x13, 0x04, 0x02, 0x30, 0x00, 0x30, 0x0b,
  0x06, 0x03, 0x55, 0x1d, 0x0f, 0x04, 0x04, 0x03, 0x02, 0x05, 0xe0, 0x30,
  0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0c,
  0x05, 0x00, 0x03, 0x82, 0x02, 0x01, 0x00, 0xbe, 0x33, 0x3e, 0xe7, 0x77,
  0x16, 0x1e, 0xa6, 0x77, 0x64, 0x54, 0xa8, 0xe3, 0x46, 0x08, 0xed, 0x93,
  0x81, 0x6c, 0x4c, 0x79, 0x58, 0x91, 0xf5, 0x5f, 0xd0, 0x67, 0xc5, 0xd7,
  0x31, 0x09, 0x93, 0x89, 0x6c, 0xba, 0x25, 0xb2, 0xc3, 0x94, 0xce, 0x98,
  0x1b, 0x2b, 0x05, 0xe7, 0xb5, 0xcc, 0xc2, 0xae, 0x3a, 0x4e, 0x84, 0x0a,
  0x51, 0xde, 0x58, 0x3d, 0x6a, 0x64, 0x63, 0x46, 0x7a, 0xcb, 0xa5, 0x78,
  0xb4, 0xb7, 0xf5, 0xa1, 0x00, 0x4a, 0x43, 0xdc, 0x64, 0xae, 0x91, 0x43,
  0x3d, 0x3b, 0x9c, 0x7f, 0x96, 0x56, 0xe6, 0x01, 0x68, 0x30, 0x7a, 0x55,
  0x8d, 0x31, 0x2b, 0x82, 0x97, 0x72, 0x6d, 0xfd, 0x57, 0x91, 0x12, 0xbe,
  0x11, 0xff, 0x50, 0x78, 0x96, 0xf2, 0x29, 0x94, 0x77, 0x91, 0x34, 0x42,
  0x4e, 0x78, 0x19, 0x34, 0x28, 0x05, 0xa7, 0x8d, 0x92, 0x74, 0x9c, 0x71,
  0xff, 0x9b, 0x43, 0x6b, 0x32, 0x80, 0x80, 0x60, 0xf9, 0xf6, 0xef, 0xdd,
  0xb3, 0xc5, 0xed, 0xb1, 0x08, 0xad, 0x6d, 0x90, 0x49, 0xe3, 0x7d, 0x3e,
  0xa9, 0xbc, 0x63, 0x5d, 0xd5, 0x77, 0x91, 0x1b, 0x3a, 0x3b, 0x84, 0xea,
  0x33, 0x08, 0x06, 0x48, 0xfc, 0x44, 0x59, 0x84, 0x00, 0xac, 0x14, 0x8c,
  0xc4, 0x6c, 0x8a, 0x81, 0x4e, 0xa8, 0xfc, 0x94, 0xc0, 0x5a, 0x27, 0xf0,
  0xe3, 0x81, 0x96, 0xe9, 0x5f, 0x1d, 0x9f, 0xb9, 0x52, 0x62, 0x90, 0xdc,
  0x2a, 0x5c, 0xbe, 0xd9, 0x0e, 0x6c, 0x00, 0x90, 0xc8, 0xf1, 0xdd, 0x04,
  0xa4, 0xaf, 0x20, 0xb2, 0x4f, 0xd4, 0x32, 0x0c, 0x2b, 0x01, 0x1e, 0xc7,
  0x72, 0xc4, 0x81, 0xc3, 0x9b, 0x2a, 0xef, 0xae, 0xc8, 0xfc, 0x23, 0x0d,
  0x00, 0x3b, 0xe7, 0x0f, 0xa7, 0x62, 0x8b, 0x77, 0x88, 0x0c, 0x6f, 0xb8,
  0x7a, 0x7f, 0xbc, 0xfa, 0xa0, 0xf7, 0x1f, 0xcd, 0x90, 0xd6, 0x35, 0x88,
  0x0e, 0x03, 0xf3, 0x3d, 0x88, 0xba, 0x33, 0x1f, 0x2c, 0x62, 0xbe, 0x9f,
  0x5e, 0xe5, 0x62, 0xe7, 0x96, 0x3f, 0x64, 0x76, 0xe4, 0xc6, 0x68, 0xdb,
  0x0b, 0x7f, 0x72, 0xec, 0xfb, 0x8d, 0x2f, 0x0b, 0x5b, 0x73, 0x93, 0xcb,
  0x86, 0xdf, 0xf5, 0xa0, 0xc3, 0x5c, 0x23, 0x00, 0x76, 0xed, 0x9a, 0xfd,
  0xd5, 0x99, 0x64, 0xe9, 0x4f, 0x79, 0x51, 0x4f, 0x78, 0x36, 0xd7, 0x3d,
  0x05, 0x10, 0x6a, 0x05, 0x1d, 0xea, 0xe8, 0x40, 0x85, 0xfc, 0xb1, 0x49,
  0x23, 0x2f, 0x59, 0x9c, 0x4a, 0x3b, 0xb9, 0x24, 0x26, 0x02, 0xcf, 0x89,
  0x1d, 0xa1, 0x99, 0xae, 0x0e, 0x56, 0x90, 0xf6, 0x7a, 0xde, 0x19, 0x38,
  0x63, 0x1b, 0x71, 0x22, 0xea, 0x99, 0xee, 0x91, 0x15, 0x83, 0x4d, 0xee,
  0xb0, 0x66, 0xd4, 0xbd, 0x95, 0xfa, 0xcc, 0x9e, 0xb9, 0xc9, 0x6e, 0x9b,
  0xab, 0xc5, 0xf8, 0xaa, 0x8c, 0xfd, 0xa8, 0x66, 0xdf, 0x48, 0x4c, 0x46,
  0xff, 0xf8, 0x42, 0x00, 0x5c, 0xf7, 0x9c, 0x2e, 0x5e, 0xcd, 0xc5, 0xcf,
  0x0d, 0xd3, 0xc0, 0x8a, 0xe4, 0xe1, 0xe1, 0xbf, 0x89, 0x60, 0x66, 0xf7,
  0x14, 0x5c, 0x8f, 0x1b, 0x66, 0x57, 0x5f, 0x66, 0x87, 0x80, 0xd3, 0x54,
  0x04, 0x81, 0x27, 0x2c, 0xe6, 0x40, 0x0b, 0xd7, 0xe5, 0x9e, 0x98, 0x8c,
  0x4b, 0xc3, 0x6a, 0x18, 0x7b, 0xe2, 0xf8, 0xc4, 0x2a, 0x6e, 0x02, 0x04,
  0x39, 0x43, 0x29, 0x0f, 0xe1, 0xdc, 0x2f, 0xc3, 0xd6, 0xf6, 0xeb, 0x03,
  0x35, 0xa3, 0x36, 0xf6, 0x48, 0xde, 0xbf, 0x0d, 0xae, 0x2f, 0xc4, 0x39,
  0xc3, 0xa1, 0x54, 0x75, 0x53, 0x09, 0x50, 0x97, 0xc8, 0xaa, 0x02, 0x83,
  0xb1, 0xfe, 0x3f, 0x29, 0xb0, 0xfc, 0xed, 0xa0, 0xca, 0x19, 0x2c, 0xee,
  0xc7, 0x38, 0xd6, 0x9d, 0x8e, 0xd0, 0x39, 0x11, 0x9c, 0xcc, 0xc8, 0x56,
  0x2c, 0x99, 0xc6
},
{ // cert algorithm ID = rsassaPss
  0x30, 0x82, 0x06, 0x8d, 0x30, 0x82, 0x04, 0x44, 0xa0, 0x03, 0x02, 0x01,
  0x02, 0x02, 0x14, 0x0f, 0x64, 0x2f, 0xcd, 0xfb, 0x29, 0xd9, 0x8c, 0x35,
  0xff, 0xd2, 0x3d, 0x0c, 0xef, 0xd0, 0x42, 0x57, 0xa2, 0x3e, 0xb3, 0x30,
  0x3e, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0a,
  0x30, 0x31, 0xa0, 0x0d, 0x30, 0x0b, 0x06, 0x09, 0x60, 0x86, 0x48, 0x01,
  0x65, 0x03, 0x04, 0x02, 0x02, 0xa1, 0x1a, 0x30, 0x18, 0x06, 0x09, 0x2a,
  0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x08, 0x30, 0x0b, 0x06, 0x09,
  0x60, 0x86, 0x48, 0x01, 0x65, 0x03, 0x04, 0x02, 0x02, 0xa2, 0x04, 0x02,
  0x02, 0x01, 0xce, 0x30, 0x81, 0xa4, 0x31, 0x0b, 0x30, 0x09, 0x06, 0x03,
  0x55, 0x04, 0x06, 0x13, 0x02, 0x41, 0x55, 0x31, 0x11, 0x30, 0x0f, 0x06,
  0x03, 0x55, 0x04, 0x08, 0x0c, 0x08, 0x56, 0x69, 0x63, 0x74, 0x6f, 0x72,
  0x69, 0x61, 0x31, 0x12, 0x30, 0x10, 0x06, 0x03, 0x55, 0x04, 0x07, 0x0c,
  0x09, 0x4d, 0x65, 0x6c, 0x62, 0x6f, 0x75, 0x72, 0x6e, 0x65, 0x31, 0x22,
  0x30, 0x20, 0x06, 0x03, 0x55, 0x04, 0x0a, 0x0c, 0x19, 0x54, 0x65, 0x73,
  0x74, 0x20, 0x72, 0x65, 0x73, 0x65, 0x61, 0x72, 0x63, 0x68, 0x20, 0x69,
  0x6e, 0x73, 0x74, 0x69, 0x74, 0x75, 0x74, 0x69, 0x6f, 0x6e, 0x31, 0x10,
  0x30, 0x0e, 0x06, 0x03, 0x55, 0x04, 0x0b, 0x0c, 0x07, 0x49, 0x54, 0x20,
  0x74, 0x65, 0x61, 0x6d, 0x31, 0x14, 0x30, 0x12, 0x06, 0x03, 0x55, 0x04,
  0x03, 0x0c, 0x0b, 0x31, 0x33, 0x33, 0x2e, 0x34, 0x35, 0x2e, 0x37, 0x37,
  0x2e, 0x33, 0x31, 0x22, 0x30, 0x20, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86,
  0xf7, 0x0d, 0x01, 0x09, 0x01, 0x16, 0x13, 0x69, 0x74, 0x40, 0x72, 0x65,
  0x73, 0x65, 0x61, 0x72, 0x63, 0x68, 0x69, 0x6e, 0x73, 0x74, 0x69, 0x2e,
  0x69, 0x6f, 0x30, 0x1e, 0x17, 0x0d, 0x32, 0x30, 0x30, 0x32, 0x31, 0x37,
  0x30, 0x38, 0x32, 0x38, 0x30, 0x36, 0x5a, 0x17, 0x0d, 0x32, 0x32, 0x30,
  0x32, 0x30, 0x36, 0x30, 0x38, 0x32, 0x38, 0x30, 0x36, 0x5a, 0x30, 0x81,
  0xa4, 0x31, 0x0b, 0x30, 0x09, 0x06, 0x03, 0x55, 0x04, 0x06, 0x13, 0x02,
  0x41, 0x55, 0x31, 0x11, 0x30, 0x0f, 0x06, 0x03, 0x55, 0x04, 0x08, 0x0c,
  0x08, 0x56, 0x69, 0x63, 0x74, 0x6f, 0x72, 0x69, 0x61, 0x31, 0x12, 0x30,
  0x10, 0x06, 0x03, 0x55, 0x04, 0x07, 0x0c, 0x09, 0x4d, 0x65, 0x6c, 0x62,
  0x6f, 0x75, 0x72, 0x6e, 0x65, 0x31, 0x22, 0x30, 0x20, 0x06, 0x03, 0x55,
  0x04, 0x0a, 0x0c, 0x19, 0x54, 0x65, 0x73, 0x74, 0x20, 0x72, 0x65, 0x73,
  0x65, 0x61, 0x72, 0x63, 0x68, 0x20, 0x69, 0x6e, 0x73, 0x74, 0x69, 0x74,
  0x75, 0x74, 0x69, 0x6f, 0x6e, 0x31, 0x10, 0x30, 0x0e, 0x06, 0x03, 0x55,
  0x04, 0x0b, 0x0c, 0x07, 0x49, 0x54, 0x20, 0x74, 0x65, 0x61, 0x6d, 0x31,
  0x14, 0x30, 0x12, 0x06, 0x03, 0x55, 0x04, 0x03, 0x0c, 0x0b, 0x31, 0x33,
  0x33, 0x2e, 0x34, 0x35, 0x2e, 0x37, 0x37, 0x2e, 0x33, 0x31, 0x22, 0x30,
  0x20, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x09, 0x01,
  0x16, 0x13, 0x69, 0x74, 0x40, 0x72, 0x65, 0x73, 0x65, 0x61, 0x72, 0x63,
  0x68, 0x69, 0x6e, 0x73, 0x74, 0x69, 0x2e, 0x69, 0x6f, 0x30, 0x82, 0x02,
  0x22, 0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01,
  0x01, 0x01, 0x05, 0x00, 0x03, 0x82, 0x02, 0x0f, 0x00, 0x30, 0x82, 0x02,
  0x0a, 0x02, 0x82, 0x02, 0x01, 0x00, 0xe3, 0x46, 0xa6, 0xd3, 0x63, 0x65,
  0xe4, 0xae, 0xdb, 0xeb, 0xd5, 0x53, 0x52, 0x4d, 0x6a, 0xf8, 0x80, 0xed,
  0x82, 0x0a, 0x87, 0x49, 0x40, 0xdb, 0x07, 0xb0, 0x59, 0x27, 0x9a, 0x5b,
  0x10, 0x88, 0x6e, 0x6f, 0xd6, 0x5a, 0xac, 0xfc, 0x6c, 0xe0, 0x2d, 0x94,
  0xdf, 0x97, 0xac, 0x2f, 0x0b, 0xb0, 0x5e, 0x53, 0xff, 0x5e, 0x68, 0xd3,
  0x10, 0xc0, 0xaf, 0xfc, 0x55, 0x35, 0x3f, 0x4b, 0x35, 0x90, 0x51, 0xc4,
  0x54, 0xdd, 0x6f, 0xdb, 0x3a, 0x7f, 0xf7, 0x76, 0x20, 0x5a, 0x44, 0x7c,
  0x9b, 0x87, 0xa5, 0xfd, 0x5a, 0x1b, 0xa1, 0x64, 0xea, 0x57, 0x69, 0x72,
  0x5a, 0x29, 0x1f, 0xd6, 0x2a, 0x24, 0x5e, 0xf2, 0xc3, 0x79, 0xd5, 0x80,
  0x11, 0xcb, 0x54, 0xfd, 0xd3, 0xfe, 0x6c, 0x18, 0x6b, 0xf2, 0x0a, 0x4c,
  0x6f, 0x5b, 0x08, 0xe3, 0xed, 0x63, 0x46, 0x2e, 0xfd, 0x2d, 0xff, 0x17,
  0x9d, 0x4b, 0xad, 0x5c, 0xa3, 0x80, 0x56, 0xa2, 0x0d, 0xf7, 0xd7, 0xe3,
  0x28, 0xdb, 0xa9, 0x6a, 0x80, 0x8b, 0xa3, 0x93, 0x8c, 0x7f, 0x33, 0x7a,
  0xea, 0x3a, 0x8c, 0xc4, 0x4a, 0x0d, 0x1d, 0xcd, 0x72, 0x59, 0x96, 0x74,
  0x5d, 0x6d, 0x38, 0xb2, 0x40, 0x13, 0x3f, 0x5e, 0x3c, 0xd0, 0x2b, 0xa5,
  0x54, 0x49, 0x29, 0xcf, 0xe6, 0x52, 0xf8, 0x86, 0x36, 0x7d, 0x5d, 0xb0,
  0x03, 0x12, 0xa0, 0xe6, 0x19, 0x4e, 0xa7, 0x9f, 0x37, 0xd7, 0xd4, 0x8a,
  0x9b, 0x0b, 0x04, 0x6e, 0xf5, 0x31, 0x7c, 0x68, 0x44, 0x04, 0x62, 0x0b,
  0x96, 0x40, 0xa2, 0xc1, 0x84, 0x35, 0xc1, 0x5f, 0xa6, 0xfb, 0xe1, 0x5c,
  0x7d, 0xf0, 0x69, 0x84, 0xb5, 0x6b, 0x9c, 0x6e, 0x82, 0xc1, 0x2c, 0x88,
  0x7a, 0x8e, 0x26, 0xe5, 0xad, 0xdd, 0x61, 0xcf, 0x1b, 0xff, 0xf8, 0x3f,
  0x9b, 0xc4, 0xfa, 0x54, 0x90, 0xeb, 0x0f, 0xf6, 0x98, 0x9a, 0xcd, 0xc9,
  0xfa, 0x1f, 0xd6, 0x98, 0xf3, 0xf6, 0xb8, 0x54, 0xff, 0x3c, 0x8a, 0x12,
  0x77, 0x12, 0x94, 0xf9, 0x60, 0x3d, 0x64, 0xe8, 0x77, 0xd4, 0xaa, 0x48,
  0x64, 0x44, 0x90, 0x7c, 0x28, 0xa1, 0xff, 0x69, 0x6b, 0x46, 0x5f, 0xde,
  0x36, 0x0b, 0xb2, 0xdd, 0xeb, 0x27, 0xda, 0x4b, 0x10, 0x80, 0x38, 0x89,
  0x71, 0xeb, 0x40, 0x2e, 0xb4, 0xd0, 0x12, 0x66, 0x49, 0xf8, 0x9b, 0xf2,
  0x1c, 0x80, 0x37, 0xea, 0xc3, 0x78, 0x72, 0xc6, 0x15, 0x35, 0x70, 0x31,
  0x98, 0x6c, 0xc8, 0x7b, 0xf1, 0xe8, 0x36, 0x9c, 0x6d, 0xe2, 0x7e, 0x88,
  0xad, 0xab, 0xe5, 0xc6, 0x9d, 0xea, 0xb2, 0x68, 0x70, 0x41, 0x5c, 0xb6,
  0xc4, 0xb3, 0x49, 0x6e, 0x34, 0xb2, 0xeb, 0x28, 0xc3, 0x7e, 0x79, 0x4b,
  0x00, 0x49, 0x18, 0x19, 0xc2, 0xbf, 0x7b, 0x2a, 0xa2, 0x9c, 0x68, 0x84,
  0x6d, 0x26, 0xa4, 0x2f, 0xf4, 0x8e, 0x42, 0x77, 0xe0, 0x1c, 0x61, 0xcd,
  0xef, 0x3e, 0x30, 0x8b, 0xea, 0xa5, 0x9e, 0xeb, 0x60, 0xdf, 0xba, 0x11,
  0x27, 0x3c, 0xd4, 0xe5, 0x1b, 0x8f, 0xe3, 0xdc, 0x07, 0x1f, 0x0e, 0xb2,
  0x9e, 0xf9, 0x63, 0x4f, 0x6e, 0x07, 0x34, 0xd4, 0x86, 0x2f, 0xaa, 0x4b,
  0xd3, 0xd9, 0xc2, 0x02, 0xb0, 0xaf, 0xe4, 0xb1, 0xce, 0x24, 0xbf, 0xf2,
  0x55, 0x47, 0xd3, 0xa9, 0xcd, 0x80, 0x1b, 0xc1, 0xc1, 0x7a, 0x7a, 0xa3,
  0xc7, 0x0e, 0xd2, 0xa6, 0x9e, 0x5d, 0x29, 0xf7, 0x72, 0xc7, 0x50, 0xa0,
  0x54, 0xc9, 0x27, 0x4e, 0xdb, 0xfd, 0x4e, 0xea, 0xb9, 0x12, 0x01, 0x77,
  0x37, 0x6b, 0xd3, 0x93, 0xe4, 0xeb, 0x8f, 0xcd, 0xe3, 0x65, 0x3c, 0x7a,
  0xad, 0x89, 0xa4, 0x24, 0x43, 0x79, 0x63, 0x21, 0x18, 0x38, 0x63, 0x83,
  0xe4, 0xff, 0x97, 0xf7, 0xfe, 0x01, 0x5c, 0xce, 0xea, 0xeb, 0xc7, 0x80,
  0xa3, 0xdf, 0x02, 0x03, 0x01, 0x00, 0x01, 0xa3, 0x53, 0x30, 0x51, 0x30,
  0x1d, 0x06, 0x03, 0x55, 0x1d, 0x0e, 0x04, 0x16, 0x04, 0x14, 0x24, 0x21,
  0xc5, 0xff, 0x75, 0x34, 0xe8, 0xad, 0x58, 0x58, 0x04, 0x6a, 0xf5, 0x5f,
  0x42, 0x09, 0xa2, 0x04, 0x84, 0x96, 0x30, 0x1f, 0x06, 0x03, 0x55, 0x1d,
  0x23, 0x04, 0x18, 0x30, 0x16, 0x80, 0x14, 0x24, 0x21, 0xc5, 0xff, 0x75,
  0x34, 0xe8, 0xad, 0x58, 0x58, 0x04, 0x6a, 0xf5, 0x5f, 0x42, 0x09, 0xa2,
  0x04, 0x84, 0x96, 0x30, 0x0f, 0x06, 0x03, 0x55, 0x1d, 0x13, 0x01, 0x01,
  0xff, 0x04, 0x05, 0x30, 0x03, 0x01, 0x01, 0xff, 0x30, 0x3e, 0x06, 0x09,
  0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x0a, 0x30, 0x31, 0xa0,
  0x0d, 0x30, 0x0b, 0x06, 0x09, 0x60, 0x86, 0x48, 0x01, 0x65, 0x03, 0x04,
  0x02, 0x02, 0xa1, 0x1a, 0x30, 0x18, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86,
  0xf7, 0x0d, 0x01, 0x01, 0x08, 0x30, 0x0b, 0x06, 0x09, 0x60, 0x86, 0x48,
  0x01, 0x65, 0x03, 0x04, 0x02, 0x02, 0xa2, 0x04, 0x02, 0x02, 0x01, 0xce,
  0x03, 0x82, 0x02, 0x01, 0x00, 0xa8, 0x90, 0x39, 0x1c, 0xc0, 0xde, 0xe2,
  0xee, 0x29, 0xd5, 0xc4, 0x7a, 0xf7, 0x11, 0x51, 0xb9, 0xf0, 0x2f, 0x04,
  0x33, 0x37, 0xc4, 0xcc, 0x20, 0xc9, 0x83, 0xa4, 0x4a, 0x9e, 0xba, 0xe2,
  0xff, 0x90, 0xcb, 0x88, 0xe7, 0x79, 0x58, 0x6d, 0xae, 0x08, 0x64, 0xa6,
  0x45, 0xd0, 0xff, 0x4a, 0xfc, 0x9e, 0xe1, 0xa6, 0xf3, 0x81, 0x39, 0x92,
  0xeb, 0xb6, 0x6b, 0x9c, 0x31, 0x86, 0xf9, 0x79, 0x34, 0xb9, 0x3b, 0xba,
  0x18, 0x34, 0xfa, 0x26, 0xab, 0x4a, 0xab, 0x78, 0xcb, 0x03, 0xe7, 0xe7,
  0xf7, 0x0a, 0x90, 0x87, 0xfa, 0x11, 0xf3, 0x89, 0xca, 0x9c, 0x06, 0x38,
  0x54, 0x94, 0xa5, 0x94, 0x2c, 0x05, 0x4a, 0x73, 0x11, 0x62, 0xfe, 0x81,
  0x9a, 0x81, 0x61, 0x12, 0x9f, 0x82, 0x14, 0x3a, 0xe4, 0x18, 0xd6, 0x23,
  0xd5, 0xb7, 0x90, 0x2a, 0xf5, 0xeb, 0xf7, 0xb0, 0x6c, 0xdb, 0xa8, 0xe5,
  0x9b, 0xe9, 0xc1, 0xbe, 0x41, 0x2b, 0x85, 0xe8, 0x0e, 0x8d, 0xa0, 0xf5,
  0x38, 0x1a, 0x29, 0xc4, 0xb0, 0x96, 0x8e, 0x4d, 0x6c, 0xc3, 0x82, 0x8e,
  0x30, 0xbe, 0xb2, 0x2d, 0xc0, 0xc5, 0xde, 0x40, 0xf8, 0x89, 0x96, 0xad,
  0x8a, 0xa6, 0x62, 0x52, 0x7f, 0xc4, 0xd9, 0x6a, 0xbe, 0x7c, 0xe7, 0x41,
  0x67, 0x01, 0xa8, 0xa1, 0x79, 0xc1, 0xef, 0x33, 0xec, 0x61, 0x60, 0x03,
  0xb0, 0x09, 0x42, 0x43, 0x4a, 0x52, 0xe1, 0x92, 0xe7, 0xf9, 0xe5, 0x78,
  0xd0, 0xa4, 0xa6, 0xb5, 0xa0, 0xe6, 0x90, 0x34, 0x95, 0x21, 0xb1, 0xfc,
  0xf1, 0xcb, 0x2e, 0xe2, 0xc1, 0x5a, 0x51, 0x2e, 0xad, 0x6b, 0x6d, 0xf7,
  0xaf, 0x02, 0xd6, 0x21, 0x2a, 0xbe, 0x37, 0xcc, 0x84, 0x79, 0xe1, 0x6a,
  0x5a, 0x0f, 0x9c, 0x09, 0x39, 0xab, 0xa6, 0x19, 0x1c, 0x96, 0x51, 0xc8,
  0x78, 0x4e, 0x39, 0xa2, 0x9e, 0xd9, 0x20, 0xf6, 0xc2, 0xeb, 0xc9, 0x44,
  0x59, 0x78, 0x7f, 0x3b, 0xb5, 0xf9, 0x99, 0x22, 0xd1, 0xcb, 0x9d, 0xa0,
  0x94, 0x04, 0xb0, 0x7e, 0x7f, 0xa3, 0x09, 0x62, 0x2b, 0x0e, 0x4f, 0x01,
  0x6e, 0x8e, 0x81, 0xe5, 0x83, 0xdb, 0xc1, 0xb2, 0x66, 0xb4, 0x00, 0x02,
  0xcc, 0x22, 0xe4, 0x7f, 0xdf, 0x31, 0x86, 0x6b, 0xd1, 0x19, 0xa4, 0x72,
  0xcc, 0x57, 0x76, 0x34, 0xf3, 0x3d, 0xb4, 0x52, 0xf5, 0x97, 0x47, 0xf3,
  0xc7, 0xcd, 0x49, 0x0b, 0xe4, 0xbf, 0x7c, 0xce, 0x66, 0xe0, 0x02, 0x2a,
  0x2f, 0x3d, 0xd7, 0xc5, 0x48, 0xe2, 0x00, 0xf4, 0xa5, 0xc4, 0xb2, 0x12,
  0xce, 0xa4, 0x28, 0x02, 0x2c, 0xb7, 0x13, 0x50, 0xa0, 0xf8, 0x4d, 0x01,
  0x4e, 0x7c, 0xe1, 0x16, 0x4f, 0x51, 0x9b, 0xb2, 0x7a, 0xc3, 0xf2, 0xf4,
  0xb6, 0xcd, 0xa2, 0x08, 0x27, 0x5f, 0xf0, 0xea, 0x2a, 0x25, 0x2e, 0x31,
  0x1f, 0x46, 0x6a, 0xca, 0x9d, 0xbb, 0x26, 0x54, 0xf7, 0xf9, 0x67, 0x0b,
  0xf5, 0xa4, 0xa2, 0x8d, 0xec, 0x3a, 0xe7, 0x80, 0x3f, 0xaf, 0xd6, 0x90,
  0x3a, 0x08, 0xf6, 0x20, 0xea, 0x6b, 0xb1, 0x2e, 0x9a, 0x82, 0x01, 0xcd,
  0x7e, 0xc6, 0xb4, 0xa4, 0x1d, 0x50, 0x59, 0x7c, 0x5c, 0x8a, 0x74, 0xc8,
  0x2f, 0x4e, 0x28, 0x81, 0xb5, 0xad, 0x60, 0x7f, 0x5b, 0x02, 0x33, 0x0f,
  0xe2, 0x01, 0xd4, 0x97, 0x9e, 0xea, 0x4c, 0x22, 0x19, 0xbd, 0x40, 0xfc,
  0xf8, 0xb3, 0x07, 0xcd, 0xb8, 0xe9, 0xf0, 0xaf, 0x44, 0xcd, 0x46, 0xbc,
  0xd8, 0x3d, 0xff, 0x3b, 0x3c, 0x62, 0x41, 0x8c, 0x9a, 0xf1, 0x45, 0x88,
  0x8e, 0x82, 0x8d, 0x0e, 0x52, 0xef, 0xb4, 0x49, 0x2b, 0xc8, 0xe1, 0x80,
  0xa2, 0x63, 0x66, 0xfe, 0x24, 0x21, 0x22, 0x08, 0x2c, 0xff, 0xc1, 0xa4,
  0xb6, 0x28, 0x9e, 0x01, 0x4e, 0x50, 0x1c, 0x47, 0x24, 0xda, 0xf5, 0x65,
  0x65
},
}; // end of mock_DER_encoded_crt_data
// clang-format on

static const word32 mock_DER_encoded_crt_len[NUM_TEST_CERTS] = {1263, 1681};

static tlsCert_t *cert_obj;
static byte       mock_sys_gettime_year[2];
static byte       mock_sys_gettime_month;
static byte       mock_sys_gettime_date;
static byte       mock_sys_gettime_hour;
static byte       mock_sys_gettime_minute;
static byte       mock_sys_gettime_second;

word32 mqttDecodeWord16(byte *buf, word16 *value) {
    if ((buf != NULL) && (value != NULL)) {
        *value = buf[1];
        *value |= buf[0] << 8;
    }
    return (word32)2;
} // end of mqttDecodeWord16

word32 tlsEncodeWord24(byte *buf, word32 value) {
    if (buf != NULL) {
        buf[0] = (value >> 16) & 0xff;
        buf[1] = (value >> 8) & 0xff;
        buf[2] = value & 0xff;
    }
    // return number of bytes used to store the encoded value
    return (word32)3;
} // end of tlsEncodeWord24

word32 tlsDecodeWord24(byte *buf, word32 *value) {
    if ((buf != NULL) && (value != NULL)) {
        *value = buf[2];
        *value |= buf[1] << 8;
        *value |= buf[0] << 16;
    }
    return (word32)3;
} // end of tlsDecodeWord24

word16 mqttHashGetOutlenBytes(mqttHashLenType type) {
    word16 out = 0;
    switch (type) {
    case MQTT_HASH_SHA256:
        out = 256; // unit: bit(s)
        break;
    case MQTT_HASH_SHA384:
        out = 384; // unit: bit(s)
        break;
    default:
        break;
    }
    out = out >> 3;
    return out;
} // end of mqttHashGetOutlenBits

tlsRespStatus tlsRespCvtFromMqttResp(mqttRespStatus in) {
    tlsRespStatus out;
    switch (in) {
    case MQTT_RESP_OK:
        out = TLS_RESP_OK;
        break;
    case MQTT_RESP_ERRARGS:
        out = TLS_RESP_ERRARGS;
        break;
    case MQTT_RESP_ERRMEM:
        out = TLS_RESP_ERRMEM;
        break;
    case MQTT_RESP_TIMEOUT:
        out = TLS_RESP_TIMEOUT;
        break;
    case MQTT_RESP_ERR_SECURE_CONN:
        out = TLS_RESP_PEER_CONN_FAIL;
        break;
    case MQTT_RESP_MALFORMED_DATA:
        out = TLS_RESP_MALFORMED_PKT;
        break;
    case MQTT_RESP_ERR_TRANSMIT:
        out = TLS_RESP_ERR_SYS_SEND_PKT;
        break;
    case MQTT_RESP_ERR_EXCEED_PKT_SZ:
        out = TLS_RESP_ERR_EXCEED_MAX_REC_SZ;
        break;
    case MQTT_RESP_ERR:
    default:
        out = TLS_RESP_ERR;
        break;
    } // end of switch-case statement
    return out;
} // end of tlsRespCvtToMqttResp

static tlsRespStatus tlsASN1GetOIDsum(const byte *in, word32 *inlen, tlsAlgoOID *oid) {
    word32        obj_idlen_sz = 0;
    word32        obj_data_sz = 0;
    tlsRespStatus status = TLS_RESP_OK;

    obj_idlen_sz = *inlen;
    status = tlsASN1GetIDlen(in, &obj_idlen_sz, (ASN_PRIMDATA_OID), &obj_data_sz);
    if (status < 0) {
        goto done;
    } else if (obj_idlen_sz < (TLS_MIN_BYTES_ASN1_OBJ_ID + TLS_MIN_BYTES_ASN1_OBJ_LEN)) {
        status = TLS_RESP_ERR_DECODE;
        goto done;
    } else if (obj_data_sz < TLS_MIN_BYTES_ASN1_OID) {
        status = TLS_RESP_ERR_DECODE;
        goto done;
    }
    *inlen = obj_idlen_sz + obj_data_sz;
    *oid = 0;
    in += obj_idlen_sz;
    while (obj_data_sz-- > 0) {
        *oid += *in++;
    }
done:
    return status;
} // end of tlsASN1GetOIDsum

tlsRespStatus tlsASN1GetIDlen(const byte *in, word32 *inlen, byte expected_idtag, word32 *datalen) {
    if (in == NULL || inlen == NULL || datalen == NULL) {
        return TLS_RESP_ERRARGS;
    }
    word32        remain_len = 0;
    tlsRespStatus status = TLS_RESP_OK;

    if (expected_idtag != *in++) {
        status = TLS_RESP_ERR_NOT_SUPPORT;
    } else {
        remain_len = *inlen - 1;
        TLS_CFG_ASN1_GET_LEN_FN(status, in, &remain_len, datalen);
        *inlen = 1 + remain_len;
        if (*datalen > TLS_MAX_BYTES_CERT_CHAIN) {
            status = TLS_RESP_ERR_CERT_OVFL;
        }
    }
    return status;
} // end of tlsASN1GetIDlen

tlsRespStatus tlsASN1GetAlgoID(const byte *in, word32 *inlen, tlsAlgoOID *out, word32 *datalen) {
    if (*inlen <
        (TLS_MIN_BYTES_ASN1_OBJ_ID + TLS_MIN_BYTES_ASN1_OBJ_LEN + TLS_MIN_BYTES_ASN1_OID)) {
        return TLS_RESP_ERRARGS;
    }
    word32        obj_idlen_sz = 0;
    word32        obj_data_sz = 0;
    tlsRespStatus status = TLS_RESP_OK;
    obj_idlen_sz = *inlen;
    status = tlsASN1GetIDlen(
        in, &obj_idlen_sz, (ASN_PRIMDATA_SEQUENCE | ASN_TAG_CONSTRUCTED), &obj_data_sz
    );
    if (status < 0) {
        goto done;
    }
    *inlen = obj_idlen_sz;
    *datalen = obj_data_sz;
    in += obj_idlen_sz;
    obj_idlen_sz = obj_data_sz;
    status = tlsASN1GetOIDsum(in, &obj_idlen_sz, out);
    // special case for RSA-PSS , there is extra information immediately following RSA-PSS OID byte
    // sequence , don't skip these extra bytes because they provide useful information e,g, hash
    // algorithm ID or salt length
    if (*out == TLS_ALGO_OID_RSASSA_PSS) {
        *datalen = obj_idlen_sz;
    }
done:
    return status;
} // end of tlsASN1GetAlgoID

tlsRespStatus tlsRSAgetPubKey(const byte *in, word32 *inlen, void **pubkey_p, word32 *datalen) {
    word32        obj_idlen_sz = 0;
    word32        obj_data_sz = 0;
    tlsRespStatus status = TLS_RESP_OK;

    obj_idlen_sz = *inlen;
    status = tlsASN1GetIDlen(in, &obj_idlen_sz, (ASN_PRIMDATA_BIT_STRING), &obj_data_sz);
    *inlen = obj_idlen_sz;
    *datalen = obj_data_sz;
    return status;
} // end of tlsRSAgetPubKey

tlsRespStatus
tlsX509getExtensions(byte *in, word32 *inlen, tlsX509v3ext_t **ext_out, word32 *datalen) {
    word32        obj_idlen_sz = 0;
    word32        obj_data_sz = 0;
    word32        remain_sz = *inlen;
    tlsRespStatus status = TLS_RESP_OK;

    *inlen = 0;
    *datalen = 0;
    // skip implicit subject & issuer ID before we point to x509v3 extensions
    byte idx = 0;
    for (idx = 1; idx <= 2; idx++) {
        if (in[0] == (ASN_TAG_CONTEXT_SPECIFIC | ASN_TAG_PRIMITIVE | idx)) {
            obj_idlen_sz = remain_sz;
            status = tlsASN1GetIDlen(in, &obj_idlen_sz, in[0], &obj_data_sz);
            if (status < 0) {
                goto done;
            }
            *inlen += obj_idlen_sz;
            *datalen += obj_data_sz;
            remain_sz -= (obj_idlen_sz + obj_data_sz);
            in += (obj_idlen_sz + obj_data_sz);
        }
    } // end of for-loop
    if (in[0] == (ASN_TAG_CONTEXT_SPECIFIC | ASN_TAG_CONSTRUCTED | 0x3)) {
        if (*ext_out == NULL) {
            *ext_out = (tlsX509v3ext_t *)XCALLOC(0x1, sizeof(tlsX509v3ext_t));
        }
        obj_idlen_sz = remain_sz;
        status = tlsASN1GetIDlen(in, &obj_idlen_sz, in[0], &obj_data_sz);
        *inlen += obj_idlen_sz;
        *datalen += obj_data_sz;
    }
done:
    return status;
} // end of tlsX509getExtensions

static void tlsFreeX509Cert(tlsCert_t *in) {
    tlsCert_t *curr_cert = in;
    if (curr_cert != NULL) {
        if (curr_cert->signature.data != NULL) {
            XMEMFREE((void *)curr_cert->signature.data);
            curr_cert->signature.data = NULL;
        }
        if (curr_cert->subject.common_name != NULL) {
            XMEMFREE((void *)curr_cert->subject.common_name);
            curr_cert->subject.common_name = NULL;
        }
        if (curr_cert->issuer.common_name != NULL) {
            XMEMFREE((void *)curr_cert->issuer.common_name);
            curr_cert->issuer.common_name = NULL;
        }
        if (curr_cert->subject.org_name != NULL) {
            XMEMFREE((void *)curr_cert->subject.org_name);
            curr_cert->subject.org_name = NULL;
        }
        if (curr_cert->issuer.org_name != NULL) {
            XMEMFREE((void *)curr_cert->issuer.org_name);
            curr_cert->issuer.org_name = NULL;
        }
        // deallocate certificate extensions
        if (curr_cert->cert_exts != NULL) {
            XMEMFREE(curr_cert->cert_exts);
            curr_cert->cert_exts = NULL;
        }
        // deallocate entire extension list
        if (curr_cert->hashed_holder_info.data != NULL) {
            XMEMFREE((void *)curr_cert->hashed_holder_info.data);
            curr_cert->hashed_holder_info.data = NULL;
        }
        if (curr_cert->issuer.hashed_dn != NULL) {
            XMEMFREE((void *)curr_cert->issuer.hashed_dn);
            curr_cert->issuer.hashed_dn = NULL;
        }
        if (curr_cert->subject.hashed_dn != NULL) {
            XMEMFREE((void *)curr_cert->subject.hashed_dn);
            curr_cert->subject.hashed_dn = NULL;
        }
        // deallocate public key, public key of CA cert must be kpet until the end of application
        if (curr_cert->pubkey_algo == TLS_ALGO_OID_RSA_KEY) {
            curr_cert->pubkey = NULL;
        }
    } // end of while loop
} // end of tlsFreeX509Cert

mqttRespStatus mqttSysGetDateTime(mqttDateTime_t *out) {
    out->year[0] = mock_sys_gettime_year[0];
    out->year[1] = mock_sys_gettime_year[1];
    out->month = mock_sys_gettime_month;
    out->date = mock_sys_gettime_date;
    out->hour = mock_sys_gettime_hour;
    out->minite = mock_sys_gettime_minute;
    out->second = mock_sys_gettime_second;
    return TLS_RESP_OK;
} // end of mqttSysGetDateTime

// ----------------------------------------------------------------

TEST_GROUP(tlsDecodeX509cert);

TEST_SETUP(tlsDecodeX509cert) {}

TEST_TEAR_DOWN(tlsDecodeX509cert) {}

TEST_GROUP_RUNNER(tlsDecodeX509cert) {
    RUN_TEST_CASE(tlsDecodeX509cert, cert_algo_rsa);
    RUN_TEST_CASE(tlsDecodeX509cert, invalid_time_chk);
    RUN_TEST_CASE(tlsDecodeX509cert, cert_algo_rsapss);
}

TEST(tlsDecodeX509cert, cert_algo_rsa) {
    const byte   *expect_signature_data = NULL;
    word16        expect_signature_len = 0;
    const byte    chosen_cert_idx = 0;
    tlsRespStatus status = TLS_RESP_OK;

    tlsEncodeWord24(&cert_obj->rawbytes.len[0], (word32)mock_DER_encoded_crt_len[chosen_cert_idx]);
    cert_obj->rawbytes.data = &mock_DER_encoded_crt_data[chosen_cert_idx][0];

    mock_sys_gettime_year[0] = 0x20;
    mock_sys_gettime_year[1] = 0x20;
    mock_sys_gettime_month = 0x02;
    mock_sys_gettime_date = 0x17;
    mock_sys_gettime_hour = 0x07;
    mock_sys_gettime_minute = 0x28;
    mock_sys_gettime_second = 0x22;

    status = tlsDecodeX509cert(cert_obj);
    TEST_ASSERT_EQUAL_INT(TLS_RESP_OK, status);
    TEST_ASSERT_EQUAL_UINT16(TLS_ALGO_OID_SHA384_RSA_SIG, cert_obj->cert_algo);
    TEST_ASSERT_EQUAL_UINT16(TLS_ALGO_OID_SHA384_RSA_SIG, cert_obj->sign_algo);
    TEST_ASSERT_EQUAL_UINT16(TLS_ALGO_OID_RSA_KEY, cert_obj->pubkey_algo);
    TEST_ASSERT_EQUAL_STRING_LEN("101.3.253.95", cert_obj->issuer.common_name, 12);
    TEST_ASSERT_EQUAL_STRING_LEN("Test Inc", cert_obj->issuer.org_name, 8);
    TEST_ASSERT_EQUAL_STRING_LEN("123.45.6.78", cert_obj->subject.common_name, 11);
    TEST_ASSERT_EQUAL_STRING_LEN("Some random company", cert_obj->subject.org_name, 19);
    expect_signature_len = 4096 >> 3; // due to 4096-bit RSA key in CA key file
    expect_signature_data = &mock_DER_encoded_crt_data[chosen_cert_idx]
                                                      [mock_DER_encoded_crt_len[chosen_cert_idx] -
                                                       expect_signature_len];
    TEST_ASSERT_EQUAL_UINT16(expect_signature_len, cert_obj->signature.len);
    TEST_ASSERT_EQUAL_STRING_LEN(
        expect_signature_data, cert_obj->signature.data, cert_obj->signature.len
    );
    tlsFreeX509Cert(cert_obj);
} // end of TEST(tlsDecodeX509cert, cert_algo_rsa)

TEST(tlsDecodeX509cert, invalid_time_chk) {
    const byte    chosen_cert_idx = 0;
    tlsRespStatus status = TLS_RESP_OK;

    tlsEncodeWord24(&cert_obj->rawbytes.len[0], (word32)mock_DER_encoded_crt_len[chosen_cert_idx]);
    cert_obj->rawbytes.data = &mock_DER_encoded_crt_data[chosen_cert_idx][0];

    mock_sys_gettime_year[0] = 0x20;
    mock_sys_gettime_year[1] = 0x20;
    mock_sys_gettime_month = 0x02;
    mock_sys_gettime_date = 0x17;
    mock_sys_gettime_hour = 0x07;
    mock_sys_gettime_minute =
        0x27; // assume current time is one minute before the certificate can be used (Not Before)
    mock_sys_gettime_second = 0x21;
    status = tlsDecodeX509cert(cert_obj);
    TEST_ASSERT_EQUAL_INT(TLS_RESP_CERT_AUTH_FAIL, status);
    TEST_ASSERT_EQUAL_STRING_LEN("101.3.253.95", cert_obj->issuer.common_name, 12);
    TEST_ASSERT_EQUAL_STRING_LEN("Test Inc", cert_obj->issuer.org_name, 8);
    TEST_ASSERT_EQUAL_UINT(NULL, cert_obj->subject.common_name);
    TEST_ASSERT_EQUAL_UINT(NULL, cert_obj->subject.org_name);
    tlsFreeX509Cert(cert_obj);
} // end of TEST(tlsDecodeX509cert, invalid_time_chk)

TEST(tlsDecodeX509cert, cert_algo_rsapss) {
    const byte   *expect_signature_data = NULL;
    word16        expect_signature_len = 0;
    const byte    chosen_cert_idx = 1;
    tlsRespStatus status = TLS_RESP_OK;

    tlsEncodeWord24(&cert_obj->rawbytes.len[0], (word32)mock_DER_encoded_crt_len[chosen_cert_idx]);
    cert_obj->rawbytes.data = &mock_DER_encoded_crt_data[chosen_cert_idx][0];

    mock_sys_gettime_year[0] = 0x20;
    mock_sys_gettime_year[1] = 0x20;
    mock_sys_gettime_month = 0x02;
    mock_sys_gettime_date = 0x17;
    mock_sys_gettime_hour = 0x08;
    mock_sys_gettime_minute = 0x28;
    mock_sys_gettime_second = 0x07;

    status = tlsDecodeX509cert(cert_obj);
    TEST_ASSERT_EQUAL_INT(TLS_RESP_OK, status);
    TEST_ASSERT_EQUAL_UINT16(TLS_ALGO_OID_RSASSA_PSS, cert_obj->cert_algo);
    TEST_ASSERT_EQUAL_UINT16(TLS_ALGO_OID_RSASSA_PSS, cert_obj->sign_algo);
    TEST_ASSERT_EQUAL_UINT16(TLS_ALGO_OID_RSA_KEY, cert_obj->pubkey_algo);
    TEST_ASSERT_EQUAL_UINT16(TLS_HASH_ALGO_SHA384, cert_obj->rsapss.hash_id);
    TEST_ASSERT_GREATER_THAN_UINT16(0, cert_obj->rsapss.salt_len);
    TEST_ASSERT_EQUAL_STRING_LEN("133.45.77.3", cert_obj->issuer.common_name, 11);
    TEST_ASSERT_EQUAL_STRING_LEN("Test research institution", cert_obj->issuer.org_name, 25);
    TEST_ASSERT_EQUAL_STRING_LEN("133.45.77.3", cert_obj->subject.common_name, 11);
    TEST_ASSERT_EQUAL_STRING_LEN("Test research institution", cert_obj->subject.org_name, 25);
    expect_signature_len = 4096 >> 3; // due to 4096-bit RSA key in CA key file
    expect_signature_data = &mock_DER_encoded_crt_data[chosen_cert_idx]
                                                      [mock_DER_encoded_crt_len[chosen_cert_idx] -
                                                       expect_signature_len];
    TEST_ASSERT_EQUAL_UINT16(expect_signature_len, cert_obj->signature.len);
    TEST_ASSERT_EQUAL_STRING_LEN(
        expect_signature_data, cert_obj->signature.data, cert_obj->signature.len
    );
    tlsFreeX509Cert(cert_obj);
} // end of TEST(tlsDecodeX509cert, cert_algo_rsapss)

static void RunAllTestGroups(void) {
    cert_obj = (tlsCert_t *)XMALLOC(sizeof(tlsCert_t));
    XMEMSET(cert_obj, 0x00, sizeof(tlsCert_t));

    RUN_TEST_GROUP(tlsDecodeX509cert);

    XMEMFREE(cert_obj);
    cert_obj = NULL;
} // end of RunAllTestGroups

int main(int argc, const char *argv[]) {
    return UnityMain(argc, argv, RunAllTestGroups);
} // end of main
